var stream = require('stream');
var util = require('util');
var winston = require('winston');

// display is 9x14
var x = 14;
var y = 9;
var speed = 200;

//ripped from the lol shield library
var font = {" ":[[0,0,0,0]],0:[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,0,0],[0,0,0,0,0,0]],"1":[[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0],[0,0,0,0,0]],"2":[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[0,0,0,0,1,0],[0,1,1,1,0,0],[1,0,0,0,0,0],[1,0,0,0,0,0],[1,1,1,1,1,0],[0,0,0,0,0,0]],"3":[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[0,0,0,0,1,0],[0,1,1,1,0,0],[0,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,0,0],[0,0,0,0,0,0]],"4":[[0,0,0,0,0,0],[0,0,0,1,0,0],[0,0,1,1,0,0],[0,1,0,1,0,0],[1,0,0,1,0,0],[1,1,1,1,1,0],[0,0,0,1,0,0],[0,0,0,1,0,0],[0,0,0,0,0,0]],"5":[[0,0,0,0,0,0],[1,1,1,1,1,0],[1,0,0,0,0,0],[1,0,0,0,0,0],[1,1,1,1,0,0],[0,0,0,0,1,0],[0,0,0,0,1,0],[1,1,1,1,0,0],[0,0,0,0,0,0]],"6":[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,0,0],[1,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,0,0],[0,0,0,0,0,0]],"7":[[0,0,0,0,0,0],[1,1,1,1,1,0],[0,0,0,0,1,0],[0,0,0,1,0,0],[0,0,0,1,0,0],[0,0,1,0,0,0],[0,0,1,0,0,0],[0,0,1,0,0,0],[0,0,0,0,0,0]],"8":[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,0,0],[0,0,0,0,0,0]],"9":[[0,0,0,0,0,0],[0,1,1,1,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,1,1,1,0],[0,0,0,0,1,0],[0,0,0,0,1,0],[1,1,1,1,0,0],[0,0,0,0,0,0]],"!":[[0,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,0],[0,1,0],[0,0,0]],"\'":[[0,0,0,0],[0,0,1,0],[0,0,1,0],[0,1,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],",":[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,1,0],[0,1,0,0],[0,0,0,0]],"A":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,0,1,0],[0,1,1,1,0],[1,0,0,1,0],[1,1,1,1,0],[0,0,0,0,0]],"B":[[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,0,0],[0,0,0,0,0]],"C":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0]],"D":[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,1,1,0,0],[0,0,0,0,0]],"E":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,1,1,1,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0]],"F":[[0,0,0,0,0],[0,1,1,1,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,0,0,0]],"G":[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[0,0,0,1,0],[1,1,1,0,0]],"H":[[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,0,0,0,0]],"I":[[0,0],[1,0],[0,0],[1,0],[1,0],[1,0],[1,0],[1,0],[0,0]],"J":[[0,0,0,0],[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[1,1,0,0],[]],"K":[[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,0],[0,0,0,0,0]],"L":[[0,0],[1,0],[1,0],[1,0],[1,0],[1,0],[1,0],[1,0],[0,0]],"M":[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[1,1,0,1,0,0],[1,0,1,0,1,0],[1,0,1,0,1,0],[1,0,1,0,1,0],[0,0,0,0,0,0]],"N":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,0,0,0,0]],"O":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0],[0,0,0,0,0]],"P":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,0,0],[1,0,0,0,0]],"Q":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[0,0,0,1,0]],"R":[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,1,1,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]],"S":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,1,0],[1,1,1,1,0],[0,0,0,0,0]],"T":[[0,0,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,1,1,0],[0,0,0,0,0]],"U":[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,0,0]],"V":[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,0,1,0,0],[0,0,1,0,0,0],[0,0,0,0,0,0]],"W":[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[1,0,1,0,1,0],[1,0,1,0,1,0],[0,1,0,1,0,0],[0,1,0,1,0,0],[0,0,0,0,0,0]],"X":[[0,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,1,0,0],[1,0,0,1,0],[0,0,0,0,0]],"Y":[[0,0,0,0,0,0],[1,0,0,0,1,0],[1,0,0,0,1,0],[0,1,0,1,0,0],[0,0,1,0,0,0],[0,0,1,0,0,0],[0,0,1,0,0,0],[0,0,1,0,0,0],[0,0,0,0,0,0]],"Z":[[0,0,0,0,0,0],[1,1,1,1,1,0],[0,0,0,0,1,0],[0,0,0,1,0,0],[0,0,1,0,0,0],[0,1,0,0,0,0],[1,0,0,0,0,0],[1,1,1,1,1,0],[0,0,0,0,0,0]]};
var chars = Object.keys(font);
//winston.info(chars);
var Renderer = module.exports = function(){
  stream.call(this);
  this.writable = true;
  this.writing = false;
};

util.inherits(Renderer, stream);

Renderer.prototype.write = function(data){
	this.marqueRender(data);
};

Renderer.prototype.end = function(){
  this.emit('end');
};

Renderer.prototype.marqueRender = function(str){
  str = str.toString ? str.toString().toUpperCase() : str.toUpperCase();
  winston.info('marqueRendering',str);
  //need to return a frame of data
  var sendFrame = function(data,desc){
    var frame = {
      data: data,
      desc: desc,
      delay: 1000
    };
    winston.info('sending frame',frame);
    this.emit('data',frame);
  }.bind(this);

  str.split('').forEach(function(letter){
    if(letter === "\n"){return;}
    var data=[];
    //var data = emptyFrame(x,y);
    sendFrame((font[letter] || font[' ']), letter);
  });
};

var emptyFrame = Renderer.emptyFrame = function(x,y){
  var frame = [];
  for (var i = 0; i < y; i++) {
    var arrayx = [];
    for(var j = 0; j < x; j++){
        arrayx.push(0);
    }
    frame.push(arrayx);
  }
  return frame;
}